-- Clean Hub with Mining Tab Only
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local guiParent = CoreGui

-- Remote
local Remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("GameHandler")
local mineArgs = { { Info = "Mine" } }

-- Sizes
local CLOSED_SZ = UDim2.new(0,1,0,1)
local HUB_SZ = UDim2.new(0,700,0,450)
local MINIMIZED_SZ = UDim2.new(0,200,0,40)

-- Tween helper
local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local function tween(obj, props)
    local tw = TweenService:Create(obj, tweenInfo, props)
    tw:Play()
    return tw
end

local function round(ui, radius)
    local c = Instance.new("UICorner", ui)
    c.CornerRadius = UDim.new(0, radius or 8)
end

-- ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CleanHubGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = guiParent

-- Main Frame
local frame = Instance.new("Frame", screenGui)
frame.Name = "MainFrame"
frame.Size = HUB_SZ
frame.Position = UDim2.new(0.5,0,0.5,0)
frame.AnchorPoint = Vector2.new(0.5,0.5)
frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
frame.Active = true
frame.BorderSizePixel = 0
round(frame,10)

-- Dragging
local dragging, dragInput, dragStart, startPos
UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset+delta.X,
            startPos.Y.Scale, startPos.Y.Offset+delta.Y
        )
    end
end)

local function enableDrag(target)
    target.InputBegan:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then
            dragging = true
            dragStart = i.Position
            startPos = frame.Position
            i.Changed:Connect(function()
                if i.UserInputState==Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    target.InputChanged:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseMovement or i.UserInputType==Enum.UserInputType.Touch then
            dragInput = i
        end
    end)
end

-- Top Bar
local bar=Instance.new("Frame",frame)
bar.Size=UDim2.new(1,0,0,40)
bar.Position=UDim2.new(0,0,0,0)
bar.BackgroundColor3=Color3.fromRGB(40,40,40)
bar.Active=true
round(bar,10)
enableDrag(bar)

local title=Instance.new("TextLabel",bar)
title.Size=UDim2.new(1,-120,1,0)
title.Position=UDim2.new(0,10,0,0)
title.BackgroundTransparency=1
title.Font=Enum.Font.SourceSansBold
title.TextSize=24
title.Text="Clean Hub"
title.TextColor3=Color3.new(1,1,1)
title.TextXAlignment=Enum.TextXAlignment.Left

local closeBtn=Instance.new("TextButton",bar)
closeBtn.Size=UDim2.new(0,30,0,30)
closeBtn.Position=UDim2.new(1,-40,0,5)
closeBtn.Text="X"
closeBtn.Font=Enum.Font.SourceSansBold
closeBtn.TextSize=18
closeBtn.BackgroundColor3=Color3.fromRGB(200,50,50)
closeBtn.TextColor3=Color3.new(1,1,1)
round(closeBtn,4)

local minBtn=Instance.new("TextButton",bar)
minBtn.Size=UDim2.new(0,30,0,30)
minBtn.Position=UDim2.new(1,-80,0,5)
minBtn.Text="-"
minBtn.Font=Enum.Font.SourceSansBold
minBtn.TextSize=22
minBtn.BackgroundColor3=Color3.fromRGB(100,100,100)
minBtn.TextColor3=Color3.new(1,1,1)
round(minBtn,4)

-- Content Area
local contentFrame=Instance.new("Frame",frame)
contentFrame.Size=UDim2.new(1,-20,1,-60)
contentFrame.Position=UDim2.new(0,10,0,50)
contentFrame.BackgroundTransparency=1
enableDrag(contentFrame)

-- Mining UI
local label = Instance.new("TextLabel", contentFrame)
label.Size = UDim2.new(0.6, -10, 0, 30)
label.Position = UDim2.new(0, 10, 0, 10)
label.BackgroundTransparency = 1
label.Text = "Auto-Mine"
label.TextColor3 = Color3.new(1,1,1)
label.Font = Enum.Font.SourceSansBold
label.TextSize = 18
label.TextXAlignment = Enum.TextXAlignment.Left

local mineBtn = Instance.new("TextButton", contentFrame)
mineBtn.Size = UDim2.new(0.35, 0, 0, 30)
mineBtn.Position = UDim2.new(0.65, 0, 0, 10)
mineBtn.Text = "OFF"
mineBtn.Font = Enum.Font.SourceSansBold
mineBtn.TextSize = 18
mineBtn.BackgroundColor3 = Color3.fromRGB(88,101,242)
mineBtn.TextColor3 = Color3.new(1,1,1)
round(mineBtn, 6)

-- Mining loop
local mining = false
local interval = 0.1
local function startMining()
    while mining do
        pcall(function()
            Remote:FireServer(unpack(mineArgs))
        end)
        task.wait(interval)
    end
end

mineBtn.MouseButton1Click:Connect(function()
    mining = not mining
    mineBtn.Text = mining and "ON" or "OFF"
    mineBtn.BackgroundColor3 = mining and Color3.fromRGB(0,170,0) or Color3.fromRGB(88,101,242)
    if mining then
        task.spawn(startMining)
    end
end)

-- Minimize + Close
local minimized = false
minBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        tween(frame, { Size = MINIMIZED_SZ })
    else
        tween(frame, { Size = HUB_SZ })
    end
    contentFrame.Visible = not minimized
end)

closeBtn.MouseButton1Click:Connect(function()
    tween(frame, { Size = CLOSED_SZ }).Completed:Wait()
    screenGui:Destroy()
end)
