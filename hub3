--== Auto Hub with Emergency Stop ==--

local Player = game.Players.LocalPlayer
local GuiName = "AutoBuyGUI"

-- Destroy old GUI if it exists
if Player.PlayerGui:FindFirstChild(GuiName) then
    Player.PlayerGui[GuiName]:Destroy()
end

--== State controller ==--
local AutoStates = {
    Eggs = {},
    Wins = false,
    Rewards = false,
    Wheel = false,
    Teleports = false
}

local function EmergencyStop()
    AutoStates.Wins = false
    AutoStates.Rewards = false
    AutoStates.Wheel = false
    AutoStates.Teleports = false
    for egg,_ in pairs(AutoStates.Eggs) do
        AutoStates.Eggs[egg] = false
    end
    print("⚠️ Emergency Stop: All automation halted.")
end

local function CloseHub()
    EmergencyStop()
    if Player.PlayerGui:FindFirstChild(GuiName) then
        Player.PlayerGui[GuiName]:Destroy()
    end
end

--== GUI ==--
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = GuiName
ScreenGui.Parent = Player.PlayerGui

local mainFrame = Instance.new("Frame", ScreenGui)
mainFrame.Size = UDim2.new(0, 500, 0, 350)
mainFrame.Position = UDim2.new(0.5, -250, 0.5, -175)
mainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)

-- Tabs holder
local tabsFrame = Instance.new("Frame", mainFrame)
tabsFrame.Size = UDim2.new(0, 120, 1, 0)
tabsFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)

local contentFrame = Instance.new("Frame", mainFrame)
contentFrame.Size = UDim2.new(1, -120, 1, 0)
contentFrame.Position = UDim2.new(0, 120, 0, 0)
contentFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 55)

--== Tab system ==--
local function switchTab(buildFunc)
    for _,v in pairs(contentFrame:GetChildren()) do
        v:Destroy()
    end
    buildFunc()
end

local function createTab(name, callback, order)
    local btn = Instance.new("TextButton", tabsFrame)
    btn.Size = UDim2.new(1, 0, 0, 40)
    btn.Position = UDim2.new(0, 0, 0, (order-1)*42)
    btn.Text = name
    btn.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 16
    btn.MouseButton1Click:Connect(function()
        switchTab(callback)
    end)
end

--== Eggs Tab ==--
local function buildEggsTab()
    local eggs = {"Egg 1","Egg 2","Egg 3","Egg 4","Egg 5","Egg 6","Egg 7","Egg 8","Egg 9","Egg 10","Egg 11","Egg 12","Egg 13","Egg 14","Egg 15"}

    local grid = Instance.new("UIGridLayout", contentFrame)
    grid.CellSize = UDim2.new(0, 140, 0, 30)
    grid.CellPadding = UDim2.new(0, 10, 0, 10)

    for _,eggName in ipairs(eggs) do
        local btn = Instance.new("TextButton", contentFrame)
        btn.Text = "OFF - "..eggName
        btn.BackgroundColor3 = Color3.fromRGB(88,101,242)
        btn.TextColor3 = Color3.new(1,1,1)

        AutoStates.Eggs[eggName] = false

        btn.MouseButton1Click:Connect(function()
            AutoStates.Eggs[eggName] = not AutoStates.Eggs[eggName]
            btn.Text = (AutoStates.Eggs[eggName] and "ON - " or "OFF - ")..eggName
            btn.BackgroundColor3 = AutoStates.Eggs[eggName] and Color3.fromRGB(0,170,0) or Color3.fromRGB(88,101,242)

            if AutoStates.Eggs[eggName] then
                task.spawn(function()
                    while AutoStates.Eggs[eggName] do
                        local args = {{Info="PurchaseEgg", Egg=eggName}}
                        pcall(function()
                            game:GetService("ReplicatedStorage").Remotes.Eggs:InvokeServer(unpack(args))
                        end)
                        task.wait(0.15)
                    end
                end)
            end
        end)
    end
end

--== Wins Tab ==--
local function buildWinsTab()
    local btn = Instance.new("TextButton", contentFrame)
    btn.Size = UDim2.new(0, 160, 0, 40)
    btn.Text = "OFF - Auto Win"
    btn.BackgroundColor3 = Color3.fromRGB(88,101,242)
    btn.TextColor3 = Color3.new(1,1,1)

    btn.MouseButton1Click:Connect(function()
        AutoStates.Wins = not AutoStates.Wins
        btn.Text = AutoStates.Wins and "ON - Auto Win" or "OFF - Auto Win"
        btn.BackgroundColor3 = AutoStates.Wins and Color3.fromRGB(0,170,0) or Color3.fromRGB(88,101,242)

        if AutoStates.Wins then
            task.spawn(function()
                while AutoStates.Wins do
                    local args = {{Info="CollectWin"}}
                    pcall(function()
                        game:GetService("ReplicatedStorage").Remotes.GameHandler:FireServer(unpack(args))
                    end)
                    task.wait(5)
                end
            end)
        end
    end)
end

--== Rewards Tab ==--
local function buildRewardsTab()
    for reward = 1, 9 do
        local btn = Instance.new("TextButton", contentFrame)
        btn.Size = UDim2.new(0, 120, 0, 30)
        btn.Position = UDim2.new(0, 10, 0, (reward-1)*35)
        btn.Text = "Claim Reward "..reward
        btn.BackgroundColor3 = Color3.fromRGB(88,101,242)
        btn.TextColor3 = Color3.new(1,1,1)

        btn.MouseButton1Click:Connect(function()
            local args = {{Info="ClaimReward", Reward = reward}}
            pcall(function()
                game:GetService("ReplicatedStorage").Remotes.Playtime:FireServer(unpack(args))
            end)
        end)
    end
end

--== Spin Wheel Tab ==--
local function buildWheelTab()
    local btn = Instance.new("TextButton", contentFrame)
    btn.Size = UDim2.new(0, 160, 0, 40)
    btn.Text = "Spin Wheel"
    btn.BackgroundColor3 = Color3.fromRGB(88,101,242)
    btn.TextColor3 = Color3.new(1,1,1)

    btn.MouseButton1Click:Connect(function()
        pcall(function()
            game:GetService("ReplicatedStorage").Remotes.Wheel:InvokeServer()
        end)
    end)
end

--== Teleports Tab ==--
local function buildTeleportsTab()
    for world = 1, 5 do
        local btn = Instance.new("TextButton", contentFrame)
        btn.Size = UDim2.new(0, 120, 0, 30)
        btn.Position = UDim2.new(0, 10, 0, (world-1)*35)
        btn.Text = "World "..world
        btn.BackgroundColor3 = Color3.fromRGB(88,101,242)
        btn.TextColor3 = Color3.new(1,1,1)

        btn.MouseButton1Click:Connect(function()
            local args = {{Info="SwitchWorld", World = world}}
            pcall(function()
                game:GetService("ReplicatedStorage").Remotes.GameHandler:FireServer(unpack(args))
            end)
        end)
    end
end

--== Emergency Stop Button on main tabs ==--
local function addEmergencyButton(order)
    local btn = Instance.new("TextButton", tabsFrame)
    btn.Size = UDim2.new(1,0,0,40)
    btn.Position = UDim2.new(0,0,0,(order-1)*42)
    btn.Text = "⚠️ STOP ALL"
    btn.BackgroundColor3 = Color3.fromRGB(200,50,50)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 16
    btn.MouseButton1Click:Connect(function()
        EmergencyStop()
    end)
end

--== Register Tabs ==--
createTab("Eggs", buildEggsTab, 1)
createTab("Wins", buildWinsTab, 2)
createTab("Rewards", buildRewardsTab, 3)
createTab("Wheel", buildWheelTab, 4)
createTab("Teleports", buildTeleportsTab, 5)
addEmergencyButton(6)

-- Start on Eggs tab
switchTab(buildEggsTab)

--== Close hub if needed
-- CloseHub()  -- call this manually to remove hub + stop everything
