-- Clean Hub (GUI Framework + Tree Farm + Chest Collector)

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer
local guiParent = game:GetService("CoreGui")

-- Sizes
local HUB_SZ = UDim2.new(0,700,0,450)
local MINIMIZED_SZ = UDim2.new(0,200,0,40)

-- Tween helper
local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local function tween(obj, props)
    local tw = TweenService:Create(obj, tweenInfo, props)
    tw:Play()
    return tw
end

local function round(ui, radius)
    local c = Instance.new("UICorner", ui)
    c.CornerRadius = UDim.new(0, radius or 8)
end

-- ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CleanHubGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = guiParent

-- Main Frame
local frame = Instance.new("Frame", screenGui)
frame.Name = "MainFrame"
frame.Size = HUB_SZ
frame.Position = UDim2.new(0.5,0,0.5,0)
frame.AnchorPoint = Vector2.new(0.5,0.5)
frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
frame.Active = true
frame.BorderSizePixel = 0
round(frame,10)

-- Dragging
local dragging, dragInput, dragStart, startPos
UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset+delta.X,
            startPos.Y.Scale, startPos.Y.Offset+delta.Y
        )
    end
end)

local function enableDrag(target)
    target.InputBegan:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then
            dragging = true
            dragStart = i.Position
            startPos = frame.Position
            i.Changed:Connect(function()
                if i.UserInputState==Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    target.InputChanged:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseMovement or i.UserInputType==Enum.UserInputType.Touch then
            dragInput = i
        end
    end)
end

-- Top Bar
local bar=Instance.new("Frame",frame)
bar.Size=UDim2.new(1,0,0,40)
bar.Position=UDim2.new(0,0,0,0)
bar.BackgroundColor3=Color3.fromRGB(40,40,40)
bar.Active=true
round(bar,10)
enableDrag(bar)

local title=Instance.new("TextLabel",bar)
title.Size = UDim2.new(1,-20,1,0)
title.Position = UDim2.new(0,10,0,0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.SourceSansBold
title.TextSize = 24
title.Text="Clean Hub"
title.TextColor3=Color3.new(1,1,1)
title.TextXAlignment=Enum.TextXAlignment.Left

local closeBtn=Instance.new("TextButton",bar)
closeBtn.Size=UDim2.new(0,30,0,30)
closeBtn.Position=UDim2.new(1,-40,0,5)
closeBtn.Text="X"
closeBtn.Font=Enum.Font.SourceSansBold
closeBtn.TextSize=18
closeBtn.BackgroundColor3=Color3.fromRGB(200,50,50)
closeBtn.TextColor3=Color3.new(1,1,1)
round(closeBtn,4)

local minBtn=Instance.new("TextButton",bar)
minBtn.Size=UDim2.new(0,30,0,30)
minBtn.Position=UDim2.new(1,-80,0,5)
minBtn.Text="-"
minBtn.Font=Enum.Font.SourceSansBold
minBtn.TextSize=22
minBtn.BackgroundColor3=Color3.fromRGB(100,100,100)
minBtn.TextColor3=Color3.new(1,1,1)
round(minBtn,4)

-- Tabs Frame
local tabsFrame=Instance.new("Frame",frame)
tabsFrame.Size=UDim2.new(0,140,1,-60)
tabsFrame.Position=UDim2.new(0,0,0,50)
tabsFrame.BackgroundTransparency=1

-- Content Frame
local contentFrame=Instance.new("Frame",frame)
contentFrame.Size=UDim2.new(1,-140,1,-60)
contentFrame.Position=UDim2.new(0,140,0,50)
contentFrame.BackgroundTransparency=1
enableDrag(contentFrame)

--------------------
-- TREE FARM TAB
--------------------
local farmingTrees = false
local farmingLoopID = 0
local MAX_DISTANCE = 100 -- Default radius

local function getCharacter()
    return player.Character or player.CharacterAdded:Wait()
end

local function fireTree(tree)
    local args = {"damage", tree.Name}
    local signal = game:GetService("ReplicatedStorage"):WaitForChild("Signal"):WaitForChild("Tree")
    pcall(function()
        signal:FireServer(unpack(args))
    end)
end

local function buildTreeFarmTab()
    for _,v in pairs(contentFrame:GetChildren()) do v:Destroy() end

    local label = Instance.new("TextLabel", contentFrame)
    label.Size = UDim2.new(1,-20,0,40)
    label.Position = UDim2.new(0,10,0,10)
    label.BackgroundTransparency = 1
    label.Text = "Tree Farm"
    label.TextColor3 = Color3.new(1,1,1)
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 22

    -- Toggle Button
    local toggleBtn = Instance.new("TextButton", contentFrame)
    toggleBtn.Size = UDim2.new(0,200,0,50)
    toggleBtn.Position = UDim2.new(0,20,0,60)
    toggleBtn.Text = "OFF"
    toggleBtn.Font = Enum.Font.SourceSansBold
    toggleBtn.TextSize = 20
    toggleBtn.BackgroundColor3 = Color3.fromRGB(150,50,50)
    toggleBtn.TextColor3 = Color3.new(1,1,1)
    round(toggleBtn,8)

    -- Radius Label
    local radiusLabel = Instance.new("TextLabel", contentFrame)
    radiusLabel.Size = UDim2.new(0,200,0,30)
    radiusLabel.Position = UDim2.new(0,20,0,130)
    radiusLabel.BackgroundTransparency = 1
    radiusLabel.Text = "Radius: "..MAX_DISTANCE.." studs"
    radiusLabel.TextColor3 = Color3.new(1,1,1)
    radiusLabel.Font = Enum.Font.SourceSans
    radiusLabel.TextSize = 18

    -- Slider
    local sliderBack = Instance.new("Frame", contentFrame)
    sliderBack.Size = UDim2.new(0,200,0,10)
    sliderBack.Position = UDim2.new(0,20,0,170)
    sliderBack.BackgroundColor3 = Color3.fromRGB(80,80,80)
    round(sliderBack,4)

    local sliderFill = Instance.new("Frame", sliderBack)
    sliderFill.Size = UDim2.new(0.5,0,1,0)
    sliderFill.BackgroundColor3 = Color3.fromRGB(50,150,50)
    round(sliderFill,4)

    local draggingSlider = false
    sliderBack.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingSlider = true
        end
    end)
    sliderBack.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingSlider = false
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if draggingSlider and input.UserInputType == Enum.UserInputType.MouseMovement then
            local relX = math.clamp((input.Position.X - sliderBack.AbsolutePosition.X) / sliderBack.AbsoluteSize.X, 0, 1)
            sliderFill.Size = UDim2.new(relX, 0, 1, 0)
            MAX_DISTANCE = math.floor(relX * 400)
            radiusLabel.Text = "Radius: " .. MAX_DISTANCE .. " studs"
        end
    end)

    toggleBtn.MouseButton1Click:Connect(function()
        farmingTrees = not farmingTrees
        toggleBtn.Text = farmingTrees and "ON" or "OFF"
        toggleBtn.BackgroundColor3 = farmingTrees and Color3.fromRGB(50,150,50) or Color3.fromRGB(150,50,50)

        if farmingTrees then
            farmingLoopID += 1
            local thisLoop = farmingLoopID
            task.spawn(function()
                while farmingTrees and farmingLoopID == thisLoop do
                    local folder = workspace:FindFirstChild("TreesFolder")
                    local char = getCharacter()
                    local root = char:FindFirstChild("HumanoidRootPart")

                    if folder and root then
                        for _, tree in pairs(folder:GetChildren()) do
                            local base = tree:FindFirstChild("Base") or tree:FindFirstChildWhichIsA("BasePart")
                            if base then
                                local dist = (base.Position - root.Position).Magnitude
                                if dist <= MAX_DISTANCE then
                                    fireTree(tree)
                                end
                            end
                        end
                    end
                    task.wait(0.2)
                end
            end)
        end
    end)
end

-- Chest Collector
local collectingChests = false
local chestLoopID = 0
local CHEST_DELAY = 0.5
local PROMPT_WAIT = 0.3

local function buildChestTab()
    for _,v in pairs(contentFrame:GetChildren()) do v:Destroy() end

    local label = Instance.new("TextLabel", contentFrame)
    label.Size = UDim2.new(1,-20,0,40)
    label.Position = UDim2.new(0,10,0,10)
    label.BackgroundTransparency = 1
    label.Text = "Chest Collector"
    label.TextColor3 = Color3.new(1,1,1)
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 22

    -- Toggle Button
    local toggleBtn = Instance.new("TextButton", contentFrame)
    toggleBtn.Size = UDim2.new(0,200,0,50)
    toggleBtn.Position = UDim2.new(0,20,0,60)
    toggleBtn.Text = "OFF"
    toggleBtn.Font = Enum.Font.SourceSansBold
    toggleBtn.TextSize = 20
    toggleBtn.BackgroundColor3 = Color3.fromRGB(150,50,50)
    toggleBtn.TextColor3 = Color3.new(1,1,1)
    round(toggleBtn,8)

    toggleBtn.MouseButton1Click:Connect(function()
        collectingChests = not collectingChests
        toggleBtn.Text = collectingChests and "ON" or "OFF"
        toggleBtn.BackgroundColor3 = collectingChests and Color3.fromRGB(50,150,50) or Color3.fromRGB(150,50,50)

        if collectingChests then
            chestLoopID += 1
            local thisLoop = chestLoopID
            local player = game.Players.LocalPlayer
            local char = player.Character or player.CharacterAdded:Wait()
            local hrp = char:WaitForChild("HumanoidRootPart")
            local chestFolder = workspace:WaitForChild("ChestFolder")

            task.spawn(function()
                while collectingChests and chestLoopID == thisLoop do
                    for _, chest in pairs(chestFolder:GetChildren()) do
                        -- Only target Chest9 variants
                        if chest.Name == "Chest9" or chest.Name == "Chest9_Huge" or chest.Name == "Chest9_Giant" then
                            local targetPart = chest:FindFirstChild("Hitpart") or chest:FindFirstChild("root")
                            local prompt = targetPart and targetPart:FindFirstChildWhichIsA("ProximityPrompt")
                            
                            if targetPart then
                                -- Teleport above the chest
                                hrp.CFrame = targetPart.CFrame + Vector3.new(0,3,0)
                                task.wait(PROMPT_WAIT)

                                if prompt then
                                    prompt:InputHoldBegin()
                                    task.wait(0.1)
                                    prompt:InputHoldEnd()
                                end

                                task.wait(CHEST_DELAY)
                            end
                        end
                    end
                    task.wait(1)
                end
            end)
        end
    end)
end

--------------------
-- TAB BUTTONS
--------------------
-- Tree Farm
local btnTreeFarm = Instance.new("TextButton", tabsFrame)
btnTreeFarm.Size = UDim2.new(1,0,0,40)
btnTreeFarm.Position = UDim2.new(0,0,0,0)
btnTreeFarm.Text = "Tree Farm"
btnTreeFarm.Font = Enum.Font.SourceSansBold
btnTreeFarm.TextSize = 16
btnTreeFarm.BackgroundColor3 = Color3.fromRGB(50,50,50)
btnTreeFarm.TextColor3 = Color3.new(1,1,1)
round(btnTreeFarm,6)
btnTreeFarm.MouseButton1Click:Connect(buildTreeFarmTab)

-- Chest Collector
local btnChest = Instance.new("TextButton", tabsFrame)
btnChest.Size = UDim2.new(1,0,0,40)
btnChest.Position = UDim2.new(0,0,0,40) -- below Tree Farm
btnChest.Text = "Chest Collector"
btnChest.Font = Enum.Font.SourceSansBold
btnChest.TextSize = 16
btnChest.BackgroundColor3 = Color3.fromRGB(50,50,50)
btnChest.TextColor3 = Color3.new(1,1,1)
round(btnChest,6)
btnChest.MouseButton1Click:Connect(buildChestTab)

-- Open Tree Farm tab by default
buildTreeFarmTab()

-- Close/Minimize
closeBtn.MouseButton1Click:Connect(function() screenGui:Destroy() end)
minBtn.MouseButton1Click:Connect(function()
    if frame.Size==HUB_SZ then
        tween(frame,{Size=MINIMIZED_SZ})
    else
        tween(frame,{Size=HUB_SZ})
    end
end)
