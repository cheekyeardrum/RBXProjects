local collectingChests = false

local function fireChest(chest)
    local hitPart = chest:FindFirstChild("HitPart")
    if hitPart then
        local prompt = hitPart:FindFirstChildWhichIsA("ProximityPrompt", true)
        if prompt then
            fireproximityprompt(prompt) -- âœ… correct way to collect
        end
    end
end

local function buildChestCollectorTab()
    for _,v in pairs(contentFrame:GetChildren()) do v:Destroy() end

    local label = Instance.new("TextLabel", contentFrame)
    label.Size = UDim2.new(1,-20,0,40)
    label.Position = UDim2.new(0,10,0,10)
    label.BackgroundTransparency = 1
    label.Text = "Chest Collector"
    label.TextColor3 = Color3.new(1,1,1)
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 22

    local toggleBtn = Instance.new("TextButton", contentFrame)
    toggleBtn.Size = UDim2.new(0,200,0,50)
    toggleBtn.Position = UDim2.new(0,20,0,60)
    toggleBtn.Text = "OFF"
    toggleBtn.Font = Enum.Font.SourceSansBold
    toggleBtn.TextSize = 20
    toggleBtn.BackgroundColor3 = Color3.fromRGB(150,50,50)
    toggleBtn.TextColor3 = Color3.new(1,1,1)
    round(toggleBtn,8)

    toggleBtn.MouseButton1Click:Connect(function()
        collectingChests = not collectingChests
        toggleBtn.Text = collectingChests and "ON" or "OFF"
        toggleBtn.BackgroundColor3 = collectingChests and Color3.fromRGB(50,150,50) or Color3.fromRGB(150,50,50)

        if collectingChests then
            task.spawn(function()
                while collectingChests do
                    local folder = workspace:FindFirstChild("ChestFolder")
                    if folder then
                        for _, chest in pairs(folder:GetChildren()) do
                            fireChest(chest)
                        end
                    end
                    task.wait(0.3)
                end
            end)
        end
    end)
end
