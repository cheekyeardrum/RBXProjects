-- ---------------------
-- UNIVERSAL TAB (Scrollable, Clean)
-- ---------------------

local utilTab = Instance.new("Frame", contentFrame)
utilTab.Size = UDim2.new(1,0,1,0)
utilTab.BackgroundTransparency = 1

-- Scroll Frame
local scroll = Instance.new("ScrollingFrame", utilTab)
scroll.Size = UDim2.new(1,0,1,0)
scroll.BackgroundTransparency = 1
scroll.ScrollBarThickness = 6
scroll.CanvasSize = UDim2.new(0,0,0,0)

local layout = Instance.new("UIListLayout", scroll)
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.Padding = UDim.new(0,8)

local function updateCanvas()
    scroll.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y + 10)
end

layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvas)

-- Helper function for button
local function createButton(title, parent, callback)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(1,0,0,30)
    btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    btn.TextColor3 = Color3.fromRGB(0,255,180)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.Text = title
    round(btn,6)
    btn.MouseButton1Click:Connect(callback)
    return btn
end

-- Helper function for slider
local function createSlider(title, min, max, default, parent, callback)
    local frame = Instance.new("Frame", parent)
    frame.Size = UDim2.new(1,0,0,40)
    frame.BackgroundTransparency = 1

    local label = Instance.new("TextLabel", frame)
    label.Size = UDim2.new(0.6,0,1,0)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 16
    label.TextColor3 = Color3.fromRGB(0,255,180)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Text = title.." : "..default

    local slider = Instance.new("TextBox", frame)
    slider.Size = UDim2.new(0.35,0,0.6,0)
    slider.Position = UDim2.new(0.62,0,0.2,0)
    slider.BackgroundColor3 = Color3.fromRGB(30,30,30)
    slider.TextColor3 = Color3.fromRGB(0,255,180)
    slider.Text = tostring(default)
    round(slider,6)

    slider.FocusLost:Connect(function()
        local val = tonumber(slider.Text)
        if val then
            val = math.clamp(val, min, max)
            slider.Text = val
            label.Text = title.." : "..val
            callback(val)
        end
    end)
    return frame
end

-- Helper function for toggle
local function createToggle(title, parent)
    local frame = Instance.new("Frame", parent)
    frame.Size = UDim2.new(1,0,0,30)
    frame.BackgroundTransparency = 1

    local label = Instance.new("TextLabel", frame)
    label.Size = UDim2.new(0.7,0,1,0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(0,255,180)
    label.Font = Enum.Font.Gotham
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Text = title

    local btn = Instance.new("TextButton", frame)
    btn.Size = UDim2.new(0.25,0,0.7,0)
    btn.Position = UDim2.new(0.72,0,0.15,0)
    btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    btn.TextColor3 = Color3.fromRGB(0,255,180)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.Text = "OFF"
    round(btn,6)

    local state = false
    btn.MouseButton1Click:Connect(function()
        state = not state
        btn.Text = state and "ON" or "OFF"
        btn.BackgroundColor3 = state and Color3.fromRGB(0,180,0) or Color3.fromRGB(40,40,40)
    end)

    return frame, function() return state end
end

-- ---------------------
-- UNIVERSAL FUNCTIONS
-- ---------------------

local cam = workspace.CurrentCamera

-- Camera FOV Slider
createSlider("Camera FOV", 70, 120, cam.FieldOfView, scroll, function(v)
    cam.FieldOfView = v
end)

-- Rejoin Server
createButton("Rejoin Server", scroll, function()
    game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, game.JobId, player)
end)

-- Teleport to Player
local tpFrame = Instance.new("Frame", scroll)
tpFrame.Size = UDim2.new(1,0,0,40)
tpFrame.BackgroundTransparency = 1

local tpBox = Instance.new("TextBox", tpFrame)
tpBox.Size = UDim2.new(0.7,0,1,0)
tpBox.Position = UDim2.new(0,0,0,0)
tpBox.BackgroundColor3 = Color3.fromRGB(30,30,30)
tpBox.TextColor3 = Color3.fromRGB(0,255,180)
tpBox.PlaceholderText = "Enter player name..."
round(tpBox,6)

local tpBtn = createButton("Teleport", tpFrame, function()
    local targetName = tpBox.Text
    local targetPlayer = Players:FindFirstChild(targetName)
    if targetPlayer and targetPlayer.Character and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0,3,0)
    end
end)
tpBtn.Size = UDim2.new(0.25,0,1,0)
tpBtn.Position = UDim2.new(0.72,0,0,0)

-- ESP / Stats Toggle
local espFrame, espGet = createToggle("ESP / Player Info Overlay", scroll)
scroll.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y + 10)

local espLabels = {}
RunService.RenderStepped:Connect(function()
    if espGet() then
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                if not espLabels[plr.Name] then
                    local lbl = Instance.new("BillboardGui", plr.Character.HumanoidRootPart)
                    lbl.Size = UDim2.new(0,100,0,50)
                    lbl.AlwaysOnTop = true
                    local text = Instance.new("TextLabel", lbl)
                    text.Size = UDim2.new(1,0,1,0)
                    text.BackgroundTransparency = 1
                    text.Font = Enum.Font.GothamBold
                    text.TextColor3 = Color3.fromRGB(0,255,180)
                    text.TextScaled = true
                    espLabels[plr.Name] = text
                end
                local dist = math.floor((plr.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude)
                espLabels[plr.Name].Text = plr.Name.." | "..dist.." studs"
            end
        end
    else
        for _, lbl in pairs(espLabels) do
            if lbl.Parent then lbl.Parent:Destroy() end
        end
        espLabels = {}
    end
end)
